generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  name          String          @unique
  email         String          @unique
  password      String
  accounts      Account[]
  SmartContract SmartContract[]
}

model Account {
  id       String @id @default(cuid())
  currency String
  balance  Float
  User     User   @relation(fields: [userId], references: [id])
  userId   String

  transactionSender    Transaction[] @relation("TransactionSender")
  transactionRecipient Transaction[] @relation("TransactionRecipient")

  @@unique([userId, currency])
}

model Transaction {
  id String @id @default(cuid())

  amount Float
  type   String

  senderId    String
  recipientId String
  signature   String

  comment String   @default("")
  date    DateTime

  sender    Account @relation(name: "TransactionSender", fields: [senderId], references: [id])
  recipient Account @relation(name: "TransactionRecipient", fields: [recipientId], references: [id])
}

model Currency {
  symbol      String @id
  name        String
  description String
  type        String @default("fiat")
}

model SmartContract {
  id String @id @default(cuid())

  name        String
  description String

  triggers    String
  permissions String
  code        String

  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  SmartContractMemory SmartContractMemory?
}

model SmartContractMemory {
  memory          String        @default("{}")
  SmartContract   SmartContract @relation(fields: [smartContractId], references: [id])
  smartContractId String        @unique
}
